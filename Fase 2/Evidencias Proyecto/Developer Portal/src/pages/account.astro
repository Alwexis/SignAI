---
import { app } from "../firebase/server";
import { getAuth } from "firebase-admin/auth";

import Layout from "../layouts/Layout.astro";
import Navbar from "../components/Navbar.astro";

/* Check if the user is authenticated */
const auth = getAuth(app);
let user: any = {
  uid: "",
  provider: "",
  name: "",
  email: "",
  plan: {},
  quota: {},
  api_keys: [],
};
let __token;
if (Astro.cookies.has("__session")) {
  const sessionCookie = Astro.cookies.get("__session")!.value;
  __token = sessionCookie;
  const decodedCookie = await auth.verifySessionCookie(sessionCookie);
  if (decodedCookie) {
    // Realizar la petici√≥n a tu servidor FastAPI
    try {
      const response = await fetch("http://localhost:8000/user/", {
        method: "GET",
        headers: {
          Authorization: `Bearer ${sessionCookie}`,
        },
      });
      if (response.ok) {
        user = await response.json();
        if (user.provider == "github.com") {
          const userData = await fetch(
            `https://api.github.com/user/${decodedCookie.firebase.identities["github.com"][0]}`
          );
          const githubData = await userData.json();
          user.username = githubData.login;
        }
      } else {
        return Astro.redirect("/signin");
      }
    } catch (error) {
      return Astro.redirect("/signin");
    }
  } else {
    return Astro.redirect("/signin");
  }
} else {
  return Astro.redirect("/signin");
}
console.log(user)
---

<Layout title="Cuenta | SignAI">
  <Navbar />
  <main
    class="relative flex items-center justify-center w-full h-full overflow-hidden"
  >
    <section
      class="w-full h-full absolute top-0 left-0 -z-10 bg-black bg-opacity-30"
    >
    </section>
    <svg
      class="w-full h-full absolute top-0 left-0 -z-20"
      id="patternId"
      width="100%"
      height="100%"
      xmlns="http://www.w3.org/2000/svg"
      ><defs
        ><pattern
          id="a"
          patternUnits="userSpaceOnUse"
          width="100"
          height="100"
          patternTransform="scale(2) rotate(0)"
          ><rect
            x="0"
            y="0"
            width="100%"
            height="100%"
            fill="rgba(23, 23, 23, 1.00)"></rect><path
            d="M89.8-5.43a.92.92 0 00-.25.05c-.33.12-.55.57-.33.84.07.1.18.15.3.2a46.68 46.68 0 016.45 4.01c.34.26.7.52 1.1.67.4.15.86.17 1.23-.05.1-.46-.32-.84-.69-1.12A72.26 72.26 0 0093-3.97c-.77-.5-1.57-.97-2.42-1.3a2.08 2.08 0 00-.77-.16zm-1.92 2.6c-.38.01-.77.25-.86.6.33.46.88.68 1.4.9a56.83 56.83 0 017.42 3.66c.3.17.6.36.93.38.34.02.72-.18.78-.51.08-.42-.34-.76-.7-.97a57.14 57.14 0 00-7.88-3.82c-.35-.13-.7-.27-1.09-.25zm-62.5 1.31c-.25 0-.5.12-.6.33-.16.37.16.77.45 1.06a42.5 42.5 0 016.56 7.68c.17.27.6.04.72-.25.26-.65-.12-1.38-.5-1.97A42.76 42.76 0 0026.4-.94a1.92 1.92 0 00-.78-.55.83.83 0 00-.25-.03zm-1.28 3.1c-.26-.03-.53.07-.65.3-.18.33.06.73.29 1.04l4.28 5.73c.26.35.54.71.95.84.4.13.96-.1.97-.54 0-.28-.2-.5-.4-.7-1.67-1.82-3-3.92-4.46-5.9-.2-.28-.42-.57-.73-.7a.79.79 0 00-.25-.07zm36.93 11.55c-.37.03-.73.22-.86.56 2 1.8 3.96 3.65 5.83 5.58.57.6 1.16 1.2 1.92 1.48.06-.13.25-.09.39-.13.18-.06.27-.29.23-.48a1.14 1.14 0 00-.3-.49 64.57 64.57 0 00-5.62-5.72 2.97 2.97 0 00-1.22-.77 1.25 1.25 0 00-.37-.03zM25.82 16.9c-.52-.02-.96.37-1.33.74l-4.26 4.21c-.85.83-1.71 1.7-2.33 2.71l.87.75c2.52-2.4 4.99-4.86 7.41-7.36.12-.12.25-.26.27-.43.06-.33-.3-.6-.63-.62zm33.63.32c-.1 0-.21.01-.32.04-.18.05-.36.16-.41.34-.06.24.13.46.3.62a88.2 88.2 0 006.47 5.42c.33.25.69.51 1.1.56.42.05.9-.2.94-.62.04-.42-.35-.75-.7-1a47.86 47.86 0 01-5.4-4.24c-.55-.53-1.24-1.13-1.98-1.12zM28.49 20a.88.88 0 00-.31 0c-.4.1-.72.4-1.01.68l-6.12 6.02c-.12.1-.24.24-.22.41.02.12.12.2.22.28l.67.54a62.8 62.8 0 006.98-6.57c.22-.23.45-.49.42-.8-.03-.3-.32-.51-.63-.56zM2.24 35.03c-.2.03-.43.14-.6.25l-4.57 2.85c-1.24.78-2.52 1.59-3.33 2.8.32.36.88.4 1.33.23.45-.17.81-.5 1.18-.81 1.88-1.56 4.14-2.6 6.08-4.08.34-.26.7-.72.44-1.07-.12-.17-.32-.2-.53-.17zm100 0c-.2.03-.43.14-.6.25l-4.57 2.85c-1.24.78-2.52 1.59-3.33 2.8.32.36.88.4 1.33.23.45-.17.81-.5 1.18-.81 1.88-1.56 4.14-2.6 6.08-4.08.34-.26.7-.72.44-1.07-.12-.17-.32-.2-.53-.17zM1.44 38.38a29.33 29.33 0 01-6.54 4.2c-.56.27-1.15.53-1.57.99-.07.08-.14.18-.12.29.01.09.1.15.16.2.66.43 1.52.06 2.21-.31 2.02-1.1 4.07-2.2 5.8-3.71.27-.24.55-.53.62-.9.07-.35-.2-.8-.57-.76zm100 0a29.33 29.33 0 01-6.54 4.2c-.56.27-1.15.53-1.57.99-.07.08-.14.18-.12.29.01.09.1.15.16.2.66.43 1.52.06 2.21-.31 2.02-1.1 4.07-2.2 5.8-3.71.27-.24.55-.53.62-.9.07-.35-.2-.8-.57-.76zm-26.39 6.9c-.26.03-.4.32-.48.58-.23.78-.34 1.59-.46 2.4l-.68 4.65-.22 1.42c-.05.37-.1.76.06 1.1.15.35.6.59.92.39.2-.14.29-.41.34-.65a43.05 43.05 0 001.07-8.98c0-.41-.16-.95-.55-.91zm-27.2.48l-.66.53c-.1.08-.2.16-.22.28-.02.17.1.31.22.41l6.12 6.03c.29.29.6.59 1 .68.4.08.9-.16.95-.57.03-.3-.2-.57-.42-.8a62.8 62.8 0 00-6.98-6.56zm28.97.87c-.36.03-.5.46-.54.82-.06.59-.02 1.19 0 1.79a31.7 31.7 0 01-.34 5.92c-.04.28.13.56.38.69.25.13.55.12.82.03.12-.04.24-.1.32-.2.08-.11.1-.25.13-.38.3-2.58.26-5.2-.1-7.78-.07-.4-.26-.92-.67-.9zM16.68 48.1c-.26-.01-.52.07-.77.16-.85.33-1.65.8-2.42 1.3a72.33 72.33 0 00-4.62 3.14c-.37.28-.79.66-.69 1.12.37.22.84.2 1.24.05.4-.15.75-.4 1.09-.67a46.7 46.7 0 016.46-4c.11-.06.22-.12.29-.22.22-.27 0-.72-.33-.84a.9.9 0 00-.25-.04zm28.23.27l-.87.75a14.34 14.34 0 002.33 2.72l4.26 4.2c.37.37.8.76 1.33.74.33 0 .69-.28.63-.61-.02-.17-.15-.32-.27-.44a257.1 257.1 0 00-7.41-7.36zM18.6 50.7c-.38-.02-.74.12-1.09.25a57.12 57.12 0 00-7.87 3.82c-.37.21-.79.54-.71.96.06.33.44.53.78.51.34-.02.64-.2.93-.37a56.83 56.83 0 017.42-3.67c.52-.2 1.07-.44 1.4-.89-.1-.36-.48-.59-.86-.6zm63.8 15.37c-.32.04-.63.25-.64.57-.01.28.19.5.39.71 1.68 1.81 3 3.91 4.47 5.9.2.27.42.56.73.7.3.14.74.07.9-.23.18-.34-.06-.74-.3-1.05l-4.27-5.73c-.26-.35-.54-.7-.95-.84a.81.81 0 00-.33-.03zm-2.66 1.86c-.2-.04-.46.15-.55.36-.26.65.12 1.38.5 1.97a42.76 42.76 0 005.6 6.27c.24.23.48.46.79.55.3.1.7 0 .83-.3.17-.37-.15-.77-.44-1.06a42.52 42.52 0 01-6.56-7.68.25.25 0 00-.17-.11zm-57.07 2.15c-.4-.04-.82.42-.59.75 1.47 2.12 2.4 4.6 2.7 7.16.05.4.44.69.85.7.4 0 .79-.2 1.08-.48-.33-.34-.4-.85-.48-1.32a13.84 13.84 0 00-2.61-6.12c-.24-.32-.55-.65-.95-.7zm-2.19 1.53a.57.57 0 00-.48.32c-.12.24-.08.52-.04.78.13.78.38 1.54.6 2.3.36 1.27.58 2.58.67 3.89.03.4.05.84.26 1.19.21.35.7.57 1.05.36.35-.22.37-.7.34-1.11A20.21 20.21 0 0020.92 72c-.06-.13-.13-.27-.26-.34a.36.36 0 00-.18-.05zm25.97.32c-.08 0-.16 0-.24.03-.3.09-.55.32-.78.55a42.76 42.76 0 00-5.61 6.27c-.38.59-.76 1.32-.5 1.97.12.29.55.52.72.25a42.5 42.5 0 016.56-7.68c.29-.29.61-.69.44-1.06-.1-.22-.34-.33-.59-.33zm1.28 3.1a.8.8 0 00-.25.06c-.31.14-.53.43-.73.7-1.46 1.99-2.8 4.09-4.47 5.9-.2.2-.4.43-.39.71.01.43.56.67.97.54.4-.13.7-.49.95-.84l4.28-5.73c.23-.31.47-.71.3-1.05-.13-.22-.4-.32-.66-.3zm23.07 5.91c-.1 0-.2.02-.28.05-.36.13-.6.45-.82.74l-.87 1.15-2.84 3.74c-.49.66-.98 1.31-1.38 2.02-.13.24-.23.54-.07.75.24.3.73.04 1.02-.25a43.05 43.05 0 005.65-7.06c.14-.2.28-.45.23-.7-.06-.28-.35-.43-.64-.44zm1.95 1.9a.67.67 0 00-.55.25 31.7 31.7 0 01-3.99 4.4c-.44.4-.9.8-1.27 1.25-.23.28-.43.69-.2.97.27.3.77.08 1.1-.16a30.25 30.25 0 005.61-5.38c.08-.1.17-.22.19-.36a.67.67 0 00-.08-.36 1.06 1.06 0 00-.6-.57.76.76 0 00-.2-.03zM89.8 94.58a.92.92 0 00-.25.05c-.33.12-.55.57-.33.84.07.1.18.15.3.2a46.68 46.68 0 016.45 4.01c.34.26.7.52 1.1.67.4.15.86.17 1.23-.05.1-.46-.32-.84-.69-1.12A72.28 72.28 0 0093 96.02c-.77-.49-1.57-.96-2.42-1.29a2.08 2.08 0 00-.77-.16zm-1.92 2.6c-.38.01-.77.24-.86.6.33.45.88.68 1.4.9a56.83 56.83 0 017.42 3.66c.3.17.6.36.93.38.34.02.72-.19.78-.52.08-.42-.34-.75-.7-.96a57.14 57.14 0 00-7.88-3.82c-.35-.13-.7-.27-1.09-.25zm-62.5 1.31c-.25 0-.5.11-.6.33-.16.37.16.77.45 1.06a42.5 42.5 0 016.56 7.68c.17.27.6.04.72-.25.26-.65-.12-1.38-.5-1.97a42.76 42.76 0 00-5.61-6.27 1.93 1.93 0 00-.78-.55.83.83 0 00-.25-.03zm-1.28 3.1c-.26-.03-.53.07-.65.3-.18.33.06.73.29 1.04l4.28 5.73c.26.35.54.71.95.84.4.13.96-.1.97-.54 0-.28-.2-.5-.4-.7-1.67-1.82-3-3.92-4.46-5.9-.2-.28-.42-.57-.73-.7a.79.79 0 00-.25-.07z"
            stroke-width="1"
            stroke="none"
            fill="rgba(38, 38, 38, 1.00)"></path><path
            d="M74.03-3.13c-.1 0-.2.03-.28.08-.35.22-.37.7-.34 1.1.18 2.55.85 5.05 1.96 7.35.06.13.13.27.26.34.23.13.54-.03.66-.27.12-.24.1-.52.05-.78-.13-.78-.39-1.54-.61-2.3a19.07 19.07 0 01-.67-3.89c-.03-.41-.05-.84-.26-1.2a.91.91 0 00-.77-.43zM70.66-1.3c-.4-.01-.78.2-1.07.48.33.34.4.85.47 1.32a13.84 13.84 0 002.62 6.12c.24.32.54.65.94.69.4.04.82-.42.6-.75a15.72 15.72 0 01-2.7-7.16c-.05-.4-.45-.7-.86-.7zm-21.8 4.48c-.4.04-.7.37-.94.69A13.84 13.84 0 0045.3 10c-.08.47-.14.98-.47 1.32.29.28.67.49 1.07.48.41-.01.81-.3.86-.7a15.72 15.72 0 012.69-7.16c.23-.33-.2-.8-.6-.75zM4.69 4.34c-.32-.01-.63.08-.83.31.15.43.54.72.9 1a46.88 46.88 0 008.5 4.74c.4.17.99.28 1.19-.1.2-.42-.27-.82-.67-1.03-2.61-1.36-5.27-2.63-7.7-4.29C5.74 4.74 5.4 4.5 5 4.4l-.31-.05zm46.36.38a.36.36 0 00-.18.05c-.13.07-.2.2-.26.34a20.2 20.2 0 00-1.96 7.34c-.03.4-.01.89.34 1.1.35.22.84 0 1.05-.35.2-.35.23-.78.26-1.2.1-1.3.31-2.61.67-3.88.22-.76.48-1.52.61-2.3.04-.26.07-.54-.05-.78a.57.57 0 00-.48-.32zm38.4 1.83c-.42.05-.78.31-1.11.56a88.18 88.18 0 00-6.46 5.42c-.18.16-.37.38-.31.62.05.18.23.3.41.34.86.23 1.67-.47 2.31-1.08a47.84 47.84 0 015.39-4.24c.35-.25.74-.58.7-1-.04-.4-.52-.67-.94-.62zM4.63 8.2c-.4-.02-.82.15-.98.51a62.06 62.06 0 009.72 4.85c.16-.29.69-.22.8-.53.09-.26-.2-.49-.45-.62L5.75 8.55a2.95 2.95 0 00-1.11-.36zM90.77 10c-.76.28-1.35.9-1.92 1.48a109.71 109.71 0 01-5.83 5.58c.17.46.76.64 1.23.53.47-.1.86-.45 1.22-.77a64.52 64.52 0 005.62-5.72c.13-.15.26-.3.3-.49.04-.19-.05-.42-.23-.48-.14-.04-.33 0-.39-.13zM2.35 16.87c-.4-.04-.54.5-.54.9.04 3.03.4 6.05 1.07 8.99.05.24.13.5.34.65.32.2.77-.04.92-.38.16-.35.1-.74.05-1.11l-.21-1.42-.68-4.65c-.12-.81-.24-1.62-.47-2.4-.08-.26-.22-.55-.48-.58zm100 0c-.4-.04-.54.5-.54.9.04 3.03.4 6.05 1.07 8.99.05.24.13.5.34.65.32.2.77-.04.92-.38.16-.35.1-.74.05-1.11l-.21-1.42-.68-4.65c-.12-.81-.24-1.62-.47-2.4-.08-.26-.22-.55-.48-.58zM.58 18.22c-.41-.03-.6.49-.66.89-.37 2.58-.4 5.2-.1 7.78.02.13.04.27.12.38.08.1.2.16.32.2.27.09.57.1.82-.03s.43-.41.39-.7a31.7 31.7 0 01-.34-5.91c.02-.6.06-1.2 0-1.8-.04-.35-.2-.78-.55-.81zm100 0c-.41-.03-.6.49-.66.89-.37 2.58-.4 5.2-.1 7.78.02.13.04.27.12.38.08.1.2.16.32.2.27.09.57.1.82-.03s.43-.41.39-.7a31.7 31.7 0 01-.34-5.91c.02-.6.06-1.2 0-1.8-.04-.35-.2-.78-.55-.81zm-20.92 7.43c-.21-.03-.4 0-.53.17-.26.35.1.81.44 1.07 1.94 1.5 4.2 2.52 6.08 4.08.37.31.73.65 1.18.82.45.17 1 .12 1.33-.24-.81-1.2-2.1-2.01-3.33-2.8l-4.56-2.85c-.18-.1-.4-.21-.61-.25zm-40.02.09c-.42-.05-.9.2-.93.62-.04.42.34.75.7 1a47.86 47.86 0 015.38 4.24c.64.61 1.46 1.31 2.32 1.08.18-.05.36-.16.4-.34.07-.24-.12-.46-.3-.62a88.2 88.2 0 00-6.47-5.42 2.4 2.4 0 00-1.1-.56zm40.83 3.27c-.37-.03-.64.4-.57.77.07.36.35.64.63.88 1.72 1.52 3.77 2.62 5.79 3.71.69.37 1.55.75 2.2.32.08-.05.16-.12.17-.2.02-.12-.05-.21-.12-.3-.42-.45-1.01-.71-1.57-.98a29.33 29.33 0 01-6.53-4.2zm-42.16.18c-.06.13-.24.09-.38.13-.18.06-.27.29-.23.48.04.19.16.34.3.49A64.57 64.57 0 0043.61 36c.36.32.74.66 1.21.77.47.1 1.06-.07 1.23-.53a109.71 109.71 0 01-5.83-5.58 5.49 5.49 0 00-1.92-1.48zm29.74 3.13c-.12 0-.25 0-.36.03-.47.11-.86.45-1.22.77a64.55 64.55 0 00-5.62 5.72c-.13.15-.26.3-.3.49-.04.19.05.42.23.48.14.04.33 0 .39.13a5.49 5.49 0 001.92-1.48c1.87-1.93 3.82-3.8 5.83-5.58-.13-.35-.5-.53-.87-.56zM18.46 34.6c-.34-.02-.72.18-.78.5-.08.43.34.76.71.97a57.13 57.13 0 007.87 3.82c.35.13.71.27 1.1.25.37-.02.76-.25.85-.61-.33-.45-.88-.68-1.4-.9a56.83 56.83 0 01-7.42-3.66c-.29-.17-.59-.35-.93-.37zm51.18 1.8c-.74 0-1.43.6-2 1.13a47.86 47.86 0 01-5.38 4.24c-.35.25-.74.58-.7 1 .04.41.52.67.94.62a2.4 2.4 0 001.1-.56 88.2 88.2 0 006.46-5.42c.18-.16.37-.38.3-.62-.04-.18-.22-.3-.4-.34a1.3 1.3 0 00-.32-.05zm-52.1.44c-.21 0-.42.06-.6.17-.1.46.31.84.68 1.12a72.33 72.33 0 004.62 3.15c.77.49 1.57.96 2.42 1.29.33.12.7.23 1.02.12.33-.12.55-.57.33-.84a.69.69 0 00-.29-.21 46.68 46.68 0 01-6.46-4.01 4.38 4.38 0 00-1.09-.67c-.2-.08-.42-.12-.63-.12zm73.1 14.98a.92.92 0 00-.77.45c-.21.35-.23.78-.26 1.19a19.07 19.07 0 01-.67 3.89c-.22.76-.48 1.52-.61 2.3-.04.26-.07.54.05.78.12.24.43.4.66.27.13-.07.2-.21.26-.34 1.1-2.3 1.78-4.8 1.96-7.34.03-.41 0-.9-.34-1.11a.59.59 0 00-.29-.09zM94 53.67c-.41 0-.81.3-.86.7a15.72 15.72 0 01-2.7 7.16c-.22.33.2.79.6.75.4-.04.7-.37.94-.7a13.84 13.84 0 002.62-6.11c.08-.47.14-.98.47-1.32a1.54 1.54 0 00-1.07-.48zM32.12 55.9c-.14 0-.28.02-.41.07a.67.67 0 00-.33.2c-.08.1-.1.25-.12.38-.3 2.58-.26 5.2.1 7.78.07.4.26.92.67.89.36-.03.5-.46.54-.82.06-.6.02-1.2 0-1.8a31.7 31.7 0 01.34-5.91c.04-.28-.13-.56-.38-.7a.9.9 0 00-.4-.09zm2.8.06a.48.48 0 00-.26.07c-.2.14-.29.4-.34.65a43.03 43.03 0 00-1.07 8.98c0 .4.15.95.54.9.26-.02.4-.31.49-.57.23-.78.34-1.59.46-2.4l.68-4.65.21-1.42c.05-.37.11-.76-.05-1.11a.77.77 0 00-.66-.45zM-.5 62.63c-.18.02-.36.07-.53.18-.07.05-.15.11-.16.2-.02.11.06.21.13.3.42.45 1 .71 1.57.98a29.34 29.34 0 016.53 4.2c.37.03.64-.4.57-.77-.07-.36-.36-.65-.64-.89-1.72-1.52-3.76-2.62-5.78-3.7-.52-.29-1.14-.56-1.69-.5zm100 0c-.18.02-.36.07-.53.18-.07.05-.15.11-.16.2-.02.11.06.21.13.3.42.45 1 .71 1.57.98a29.34 29.34 0 016.53 4.2c.37.03.64-.4.57-.77-.07-.36-.36-.65-.64-.89-1.72-1.52-3.76-2.62-5.78-3.7-.52-.29-1.14-.56-1.69-.5zm-30.2.91c-.1 0-.2.02-.3.05-.4.11-.75.35-1.09.58-2.43 1.66-5.09 2.93-7.7 4.3-.4.2-.87.6-.67 1.01.2.4.78.28 1.18.11a46.88 46.88 0 008.5-4.75c.37-.27.76-.56.91-.99-.2-.23-.51-.32-.83-.3zM.32 65.62a1.1 1.1 0 00-.97.32c.8 1.21 2.09 2.02 3.33 2.8l4.55 2.85c.36.22.9.42 1.14.08.26-.35-.1-.8-.43-1.07-1.94-1.49-4.2-2.52-6.08-4.08-.37-.3-.73-.64-1.18-.8a1.52 1.52 0 00-.36-.1zm100 0a1.1 1.1 0 00-.97.32c.8 1.21 2.09 2.02 3.33 2.8l4.55 2.85c.36.22.9.42 1.14.08.26-.35-.1-.8-.43-1.07-1.94-1.49-4.2-2.52-6.08-4.08-.37-.3-.73-.64-1.18-.8a1.52 1.52 0 00-.36-.1zM69.35 67.4c-.39.02-.76.2-1.1.36l-7.99 3.85c-.25.13-.54.36-.45.62.11.31.64.24.8.53a62.06 62.06 0 009.72-4.85c-.16-.36-.59-.53-.98-.5zM2.78 79.48a62.04 62.04 0 00-9.72 4.85c.16.36.59.53.98.5.39-.01.76-.18 1.11-.35l7.98-3.85c.25-.13.54-.36.45-.62-.11-.31-.64-.24-.8-.53zm100 0a62.04 62.04 0 00-9.72 4.85c.16.36.59.53.98.5.39-.01.76-.18 1.11-.35l7.98-3.85c.25-.13.54-.36.45-.62-.11-.31-.64-.24-.8-.53zm-99.44 3c-.22 0-.47.07-.67.16a46.88 46.88 0 00-8.5 4.75c-.37.27-.76.56-.91.99.27.3.74.37 1.14.26.4-.11.74-.35 1.08-.58 2.43-1.66 5.09-2.93 7.7-4.29.4-.21.87-.61.67-1.02-.1-.2-.3-.27-.51-.27zm100 0c-.22 0-.47.07-.67.16a46.88 46.88 0 00-8.5 4.75c-.37.27-.76.56-.91.99.27.3.74.37 1.14.26.4-.11.74-.35 1.08-.58 2.43-1.66 5.09-2.93 7.7-4.29.4-.21.87-.61.67-1.02-.1-.2-.3-.27-.51-.27zm-84.77 7.47c-.41-.02-.8.1-1.2.21-2.83.82-5.75 1.2-8.66 1.67-.44.07-1.02.3-.95.76.06.43.65.5 1.08.47 3.24-.28 6.45-.9 9.56-1.85.44-.14.9-.3 1.18-.66-.16-.37-.6-.58-1-.6zm24.05 3.35c-.16.29-.69.22-.8.53-.09.26.2.49.45.62l7.98 3.85c.35.17.72.34 1.11.36.4.02.82-.15.98-.51a62.06 62.06 0 00-9.72-4.85zm-25.47.31c-.2 0-.4.03-.59.06l-8.78 1.15c-.28.05-.63.18-.63.45.01.33.54.43.6.76 3.62-.21 7.22-.73 10.75-1.57-.04-.39-.4-.68-.77-.79a2 2 0 00-.58-.06zm24.92 2.7c-.22 0-.42.06-.52.26-.2.4.27.8.67 1.02 2.61 1.36 5.27 2.63 7.7 4.29.34.23.68.47 1.08.58.4.1.87.05 1.14-.26-.15-.43-.54-.72-.9-1a46.88 46.88 0 00-8.5-4.74 1.8 1.8 0 00-.67-.16zm31.96.56c-.1 0-.2.03-.28.08-.35.22-.37.7-.34 1.1.18 2.55.85 5.05 1.96 7.35.06.13.13.27.26.34.23.13.54-.03.66-.27.12-.24.1-.52.05-.78-.13-.78-.39-1.54-.61-2.3a19.07 19.07 0 01-.67-3.89c-.03-.41-.05-.84-.26-1.2a.91.91 0 00-.77-.43zm-3.37 1.84c-.4-.01-.78.2-1.07.48.33.34.4.85.47 1.32a13.84 13.84 0 002.62 6.12c.24.32.54.65.94.69.4.04.82-.42.6-.75a15.71 15.71 0 01-2.7-7.16c-.05-.4-.45-.7-.86-.7z"
            stroke-width="1"
            stroke="none"
            fill="rgba(64, 64, 64, 1.00)"></path></pattern
        ></defs
      ><rect
        width="800%"
        height="800%"
        transform="translate(0,0)"
        fill="url(#a)"></rect></svg
    >

    <!-- Content -->
    <section
      class="flex flex-col text-neutral-100 w-full max-w-2xl bg-neutral-950 bg-opacity-50 px-8 py-4"
    >
      <h1 class="font-montserrat font-semibold text-5xl">Cuenta</h1>
      <p class="font-nunito text-xl">Administra tu cuenta, plan y APIKeys.</p>
      <div class="w-full flex flex-col bg-neutral-800 border my-4">
        <section
          data-expanded="true"
          class="details group w-full flex flex-col bg-neutral-800 border"
        >
          <h2
            class="details-title w-full flex items-center justify-between font-montserrat font-semibold bg-neutral-900 py-2 px-4 cursor-pointer"
          >
            Informaci√≥n de Cuenta
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="1em"
              height="1em"
              viewBox="0 0 24 24"
              ><path fill="currentColor" d="m12 16l-6-6h12z"></path></svg
            >
          </h2>
          <div
            class="max-h-0 group-data-[expanded='true']:max-h-96 overflow-hidden flex flex-col px-4 group-data-[expanded='true']:py-2 w-full space-y-2 transition-all ease-in-out duration-500"
          >
            <section>
              <h3 class="font-nunito font-semibold text-lg text-neutral-200">
                Nombre
              </h3>
              <input
                type="text"
                readonly
                value={user.name}
                class="bg-neutral-900 border border-neutral-700 px-2 py-1 rounded-md outline-none w-full font-fira"
              />
            </section>
            <section>
              <h3 class="font-nunito font-semibold text-lg text-neutral-200">
                Correo
              </h3>
              <input
                type="email"
                readonly
                value={user.email}
                class="bg-neutral-900 border border-neutral-700 px-2 py-1 rounded-md outline-none w-full font-fira"
              />
            </section>
            <section>
              <h3 class="font-nunito font-semibold text-lg text-neutral-200">
                Contrase√±a
              </h3>
              <input
                type="text"
                readonly
                value="*********"
                class="bg-neutral-900 border border-neutral-700 px-2 py-1 rounded-md outline-none w-full font-fira"
              />
            </section>
            <section>
              <h3 class="font-nunito font-semibold text-lg text-neutral-200">
                Proveedor
              </h3>
              {
                user.provider == "github.com" && (
                  <p class="flex items-center w-full border border-neutral-600 px-4 py-2 font-nunito font-semibold rounded-md">
                    <svg
                      class="mr-2 w-6 h-6"
                      xmlns="http://www.w3.org/2000/svg"
                      width="1em"
                      height="1em"
                      viewBox="0 0 24 24"
                    >
                      <path
                        fill="currentColor"
                        d="M12.001 2c-5.525 0-10 4.475-10 10a9.99 9.99 0 0 0 6.837 9.488c.5.087.688-.213.688-.476c0-.237-.013-1.024-.013-1.862c-2.512.463-3.162-.612-3.362-1.175c-.113-.288-.6-1.175-1.025-1.413c-.35-.187-.85-.65-.013-.662c.788-.013 1.35.725 1.538 1.025c.9 1.512 2.337 1.087 2.912.825c.088-.65.35-1.087.638-1.337c-2.225-.25-4.55-1.113-4.55-4.938c0-1.088.387-1.987 1.025-2.687c-.1-.25-.45-1.275.1-2.65c0 0 .837-.263 2.75 1.024a9.3 9.3 0 0 1 2.5-.337c.85 0 1.7.112 2.5.337c1.913-1.3 2.75-1.024 2.75-1.024c.55 1.375.2 2.4.1 2.65c.637.7 1.025 1.587 1.025 2.687c0 3.838-2.337 4.688-4.562 4.938c.362.312.675.912.675 1.85c0 1.337-.013 2.412-.013 2.75c0 .262.188.574.688.474A10.02 10.02 0 0 0 22 12c0-5.525-4.475-10-10-10"
                      />
                    </svg>
                    Github
                    <a
                      href={`https://github.com/${user.username}`}
                      class="ml-1 text-xs text-indigo-200 self-start"
                    >
                      ({user.username})
                    </a>
                  </p>
                )
              }
              {
                user.provider == "google.com" && (
                  <p class="flex items-center w-full border border-neutral-600 px-4 py-2 font-nunito font-semibold rounded-md">
                    <svg
                      class="mr-2 w-6 h-6"
                      xmlns="http://www.w3.org/2000/svg"
                      width="1em"
                      height="1em"
                      viewBox="0 0 24 24"
                    >
                      <path
                        fill="currentColor"
                        d="M3.064 7.51A10 10 0 0 1 12 2c2.695 0 4.959.991 6.69 2.605l-2.867 2.868C14.786 6.482 13.468 5.977 12 5.977c-2.605 0-4.81 1.76-5.595 4.123c-.2.6-.314 1.24-.314 1.9s.114 1.3.314 1.9c.786 2.364 2.99 4.123 5.595 4.123c1.345 0 2.49-.355 3.386-.955a4.6 4.6 0 0 0 1.996-3.018H12v-3.868h9.418c.118.654.182 1.336.182 2.045c0 3.046-1.09 5.61-2.982 7.35C16.964 21.105 14.7 22 12 22A9.996 9.996 0 0 1 2 12c0-1.614.386-3.14 1.064-4.49"
                      />
                    </svg>
                    Google
                  </p>
                )
              }
              {
                user.provider == "password" && (
                  <p class="flex items-center w-full border border-neutral-600 px-4 py-2 font-nunito font-semibold rounded-md">
                    <svg class="mr-2 w-6 h-6" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M3 3h18a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1m17 4.238l-7.928 7.1L4 7.216V19h16zM4.511 5l7.55 6.662L19.502 5z"/></svg>
                    Email y contrase√±a
                  </p>
                )
              }
            </section>
          </div>
        </section>
        <section
          data-expanded="false"
          class="details group w-full flex flex-col bg-neutral-800 border"
        >
          <h2
            class="details-title w-full flex items-center justify-between font-montserrat font-semibold bg-neutral-900 py-2 px-4 cursor-pointer"
          >
            Plan
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="1em"
              height="1em"
              viewBox="0 0 24 24"
              ><path fill="currentColor" d="m12 16l-6-6h12z"></path></svg
            >
          </h2>
          <div
            class="max-h-0 group-data-[expanded='true']:max-h-96 overflow-hidden flex flex-col px-4 group-data-[expanded='true']:py-2 w-full space-y-2 transition-all ease-in-out duration-500"
          >
            <section>
              <h3 class="font-nunito font-semibold text-lg text-neutral-200">
                Plan
              </h3>
              <input
                type="text"
                readonly
                value={user.plan.name}
                class="bg-neutral-900 border border-neutral-700 px-2 py-1 rounded-md outline-none w-full font-fira"
              />
            </section>
            <section>
              <h3 class="font-nunito font-semibold text-lg text-neutral-200">
                Quota
              </h3>
              <div class="w-full flex items-center justify-between">
                <section class="flex flex-col w-2/5">
                  <span>Voz a Se√±as</span>
                  <p
                    class="bg-neutral-900 border border-neutral-700 px-2 py-1 rounded-md outline-none w-full flex items-center justify-between font-fira"
                  >
                    <span class="text-neutral-400">
                      {user.quota.voice_to_sign}/{user.plan.quota.voice_to_sign}
                    </span>
                    <span class="font-semibold border-l pl-4">
                      {
                        (user.quota.voice_to_sign * 100) /
                          user.plan.quota.voice_to_sign
                      }%
                    </span>
                  </p>
                </section>
                <section class="flex flex-col w-2/5">
                  <span>Se√±as a texto</span>
                  <p
                    class="bg-neutral-900 border border-neutral-700 px-2 py-1 rounded-md outline-none w-full flex items-center justify-between font-fira"
                  >
                    <span class="text-neutral-400">
                      {user.quota.video_to_text}/{user.plan.quota.video_to_text}
                    </span>
                    <span class="font-semibold border-l pl-4">
                      {
                        (user.quota.video_to_text * 100) /
                          user.plan.quota.video_to_text
                      }%
                    </span>
                  </p>
                </section>
              </div>
            </section>
          </div>
        </section>
        <section
          data-expanded="false"
          class="details group w-full flex flex-col bg-neutral-800 border"
        >
          <h2
            class="details-title w-full flex items-center justify-between font-montserrat font-semibold bg-neutral-900 py-2 px-4 cursor-pointer"
          >
            APIKeys
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="1em"
              height="1em"
              viewBox="0 0 24 24"
              ><path fill="currentColor" d="m12 16l-6-6h12z"></path></svg
            >
          </h2>
          <div
            class="max-h-0 group-data-[expanded='true']:max-h-96 overflow-hidden flex flex-col px-4 group-data-[expanded='true']:py-2 w-full space-y-2 transition-all ease-in-out duration-500"
          >
            <section class="w-full flex items-center justify-between">
              <h3 class="font-nunito font-semibold text-lg text-neutral-200">
                Lista de APIKeys
              </h3>
              <button
                id="createAPIKey"
                class="bg-indigo-500 disabled:bg-indigo-300 border border-indigo-600 px-4 py-1 rounded-md text-white font-semibold"
              >
                Nueva APIKey
              </button>
            </section>
            <section class="w-full flex items-center justify-between">
              {
                user.api_keys.length > 0 ? (
                  <ul class="w-full flex flex-col space-y-2">
                    {user.api_keys.map((apikey: any) => (
                      <li class="w-full flex items-center justify-between bg-neutral-900 border border-neutral-700 px-4 py-2 rounded-md">
                        <span class="font-fira w-10/12 max-w-[83.3%] truncate">
                          {apikey.keyHash}
                        </span>
                        <div class="flex items-center justify-end w-2/12">
                          <section class="cursor-pointer mr-2 w-6 h-6 rounded-sm text-neutral-200 flex items-center justify-center border border-neutral-400 hover:bg-neutral-600 transition-all">
                            <svg
                              class="w-4 h-4"
                              xmlns="http://www.w3.org/2000/svg"
                              width="1em"
                              height="1em"
                              viewBox="0 0 24 24"
                            >
                              <path
                                fill="currentColor"
                                d="M7 6V3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1h-3v3c0 .552-.45 1-1.007 1H4.007A1 1 0 0 1 3 21l.003-14c0-.552.45-1 1.006-1zm2 0h8v10h2V4H9zm-2 5v2h6v-2zm0 4v2h6v-2z"
                              />
                            </svg>
                          </section>
                          <section
                            data-key={apikey.keyHash}
                            data-type="delete"
                            class="cursor-pointer ml-2 w-6 h-6 rounded-sm text-neutral-200 flex items-center justify-center bg-red-500 hover:bg-red-600 border border-neutral-600 transition-all"
                          >
                            <svg
                              class="w-4 h-4"
                              xmlns="http://www.w3.org/2000/svg"
                              width="1em"
                              height="1em"
                              viewBox="0 0 24 24"
                            >
                              <path
                                fill="currentColor"
                                d="M17 6h5v2h-2v13a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V8H2V6h5V3a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1zm1 2H6v12h12zM9 4v2h6V4z"
                              />
                            </svg>
                          </section>
                        </div>
                      </li>
                    ))}
                  </ul>
                ) : (
                  <div class="w-full flex flex-col items-center justify-center text-neutral-400 font-nunito font-semibold">
                    <svg
                      class="ml-2 w-8 h-8"
                      xmlns="http://www.w3.org/2000/svg"
                      width="512"
                      height="512"
                      viewBox="0 0 384 384"
                    >
                      <>
                        <path
                          style="stroke:none;fill-rule:nonzero;fill:currentColor;fill-opacity:1"
                          d="M70.125-.375c18.18.559 35.238 13.762 48.738 24.73 2.973 2.454 2.973 2.454 6.387 4.145 2.172-.227 2.172-.227 4.531-.895l2.742-.687 1.454-.379a474.217 474.217 0 0 1 7.648-1.875l1.57-.375c29.602-6.957 62.157-7.684 92.305-4.039l2.43.293c10.5 1.316 20.77 3.191 31.02 5.824 5.382 1.438 5.382 1.438 10.8.633 1.352-.875 1.352-.875 2.484-2.11C296.266 11.876 315.72.122 335.121-.343 337.5 0 337.5 0 339.203 1.203c9.16 12.692 10.387 36.672 10.285 51.926-.738 12.691-.738 12.691 4.137 23.746l2.047 2.031c2.484 2.504 4.02 5.11 5.687 8.188l.852 1.558c13.906 25.82 16.71 55.743 8.57 83.942-3.386 10.988-8.379 21.441-15.281 30.656l-1.48 1.984c-13.528 17.27-30.707 29.086-50.317 38.516l-1.703.82c-4.059 1.899-8.184 3.243-12.5 4.43 2.734 14.754 5.59 29.422 11.922 43.11.828 1.89.828 1.89.828 3.39l1.434.254c11.78 2.598 20.742 10.523 27.168 20.453 3.316 6.035 5.543 12.902 5.898 19.793l.113 1.488c.54 11.813-4.351 23.492-12.02 32.309-7.62 7.75-18.097 14.086-29.241 14.398-1.422.012-2.852.016-4.278.012l-2.39.012c-2.641.011-5.282.011-7.922.011a5086.677 5086.677 0 0 1-21.125.043c-3.219.004-6.434.008-9.653.016-11.238.02-22.476.031-33.714.031h-1.743c-9.3.004-18.601.024-27.902.051-9.566.027-19.133.043-28.7.043-5.363 0-10.73.008-16.093.027-5.05.02-10.102.024-15.152.012-1.848-.004-3.696.004-5.54.012-17.347.11-29.507-2.68-42.644-14.703-1.496-1.512-1.496-1.512-2.996-3.762-3.078.563-6.04 1.39-9.047 2.25-12.27 3.328-23.45 2.738-34.668-3.496-9.168-5.512-14.906-14.625-17.847-24.75C11.965 330.855 12.53 320.53 16.5 312l.77-1.836c3.152-6.965 8.093-12.996 12.668-19.074 8.105-10.672 8.105-10.672 10.609-23.527l-.02-2.45-.027-1.863-1.406-.02c-2.14-.046-4.282-.101-6.422-.168l-2.215-.03c-5.887-.2-10.574-1.286-15.125-5.169l-1.41-1.691c-.48-.555-.957-1.113-1.45-1.684-3.585-5.097-3.304-10.761-2.722-16.738 1.578-5.629 4.723-9.148 9.75-12 9.227-4.695 21.473-3.598 31.11-.719 13.386 4.864 21.468 12.48 27.628 25.274 4.727 12.191 3.407 28.816-1.636 40.722-4.387 9.82-10.25 18.473-16.887 26.899-4.61 5.48-4.61 5.48-6.465 12.074 5.422-1.086 9.965-3.09 14.355-6.496C69 322.5 69 322.5 70.5 322.5l.602-1.996c3.62-10.09 11.793-17.813 21.3-22.418 6.035-2.586 6.035-2.586 8.848-2.586l.89-2.766c.934-2.836 2.008-5.582 3.141-8.343 4.387-11.329 6.453-23.5 8.719-35.391l-1.32-.344c-5.371-1.5-10.266-3.644-15.274-6.078l-2.5-1.215c-27.086-13.347-50.18-34.715-60.43-63.656-6.671-19.848-8.152-40.934-3.726-61.457l.316-1.504c2.184-10.016 6.348-19.09 11.262-28.027l.762-1.403c1.242-2.191 2.379-4.039 4.187-5.82 5.114-5.203 5.188-9.855 5.153-16.789l-.035-2.016c-.06-3.46-.012-6.921.02-10.386l.007-2.032c.043-7.152.82-14.28 2.328-21.273l.496-2.344C60.672-.367 60.672-.367 70.125-.375ZM72 13.5c-3.61 13.688-6.113 27.11-5.984 41.309l.004 4.086c.007 2.68.074 5.351.171 8.03.164 9.65-2.601 14.669-8.894 21.829-2.145 2.55-3.645 5.45-5.125 8.418l-.918 1.8c-11.621 23.305-11.996 50.212-3.93 74.645 4.414 12.293 11.934 22.567 20.926 31.883l1.633 1.773c8.039 8.512 18.047 14.63 28.367 19.977l1.59.836c52.437 27.293 122.36 27.43 178.023 10.539 21.242-6.742 40.559-16.895 56.637-32.375l1.77-1.602c16.585-15.468 24.546-38.457 25.39-60.664.602-24.12-6.953-47.703-23.762-65.379-2.171-2.558-1.972-4.96-1.918-8.168l.032-2.796.02-1.48c.195-17.735-1.63-34.688-6.032-51.911-4.52.367-7.984 1.344-12.047 3.328l-1.668.8c-10.215 5.063-19.445 12.083-28.148 19.4l-1.965 1.644-1.684 1.457c-2.683 1.73-5.175 2.043-8.32 1.535l-2.16-.61-2.477-.663-2.656-.735c-44.586-11.676-92.363-11.37-136.84.668-10.191 2.723-10.191 2.723-13.742.707l-1.574-1.422-1.926-1.648-1.082-.938C104.43 29.93 94.582 23.258 83.766 17.72l-1.47-.758C78.927 15.28 75.68 14.309 72 13.5ZM24 239.25c-1.16 2.32-.969 4.195-.75 6.75 1.008 1.79 1.008 1.79 3 3 2.402.406 4.785.379 7.219.375 6.496.16 12.176.426 17.11 5.11 2.624 4.515 3.827 8.105 3.75 13.359l-.024 1.695c-.43 13.32-8.07 23.484-16.121 33.504-7.063 8.809-11.887 17.035-11.512 28.625.953 8.223 4.52 14.746 10.828 20.082 6.496 4.71 13.238 5.566 21 4.5 3.371-.703 6.648-1.477 9.75-3 .977-2.93.36-4.645-.328-7.64l-.652-2.891-.52-2.219-1.625.656c-6.508 2.426-13.074 3.934-19.75 1.313-3.637-3.817-5.797-8.102-6.188-13.406.489-8.887 6.547-16.028 11.926-22.63C56.56 299.7 61.457 292.388 64.5 284.25l.719-1.79c2.906-8.495 3.199-20.542-.524-28.796-4.715-8.293-10.59-12.98-19.695-15.914-6.75-1.508-15.117-3.098-21 1.5Zm102.75 14.25-.285 1.586c-7.68 42.406-7.68 42.406-17.34 51.101-2.43 1.215-4.809 2.125-7.36 3.047-8.91 3.32-15.21 9.446-19.238 18.012-3.148 8.098-2.683 15.895.457 23.899 4.543 9.402 11.649 15.257 21.36 18.683 3.523.817 6.758.836 10.36.766l1.987-.02c1.602-.02 3.207-.043 4.809-.074l-.105-2.25c-.184-5.582-.332-10.328 3.105-15l.887-1.313c2.847-3.777 6.613-6.093 10.582-8.59 6.3-4.183 6.98-11.632 8.453-18.675.367-1.879.726-3.758 1.078-5.64l.582-3.028c1.457-7.684 2.648-15.395 3.633-23.156l.316-2.368.258-2.062c.535-2.234 1.395-3.793 2.711-5.668 2.32-1.16 4.195-.969 6.75-.75 1.828.984 1.828.984 3 3 .875 7.238-.809 14.762-1.969 21.89l-.304 1.903c-5.98 37.156-5.98 37.156-14.782 44.016-2.5 1.757-4.996 3.507-7.547 5.183-1.699 1.297-2.78 2.438-3.898 4.258-.352 2.805-.496 4.492 1.078 6.89 2.89 2.048 5.535 1.79 9 1.758l2.086.008c1.45.004 2.902-.004 4.356-.015 2.222-.016 4.445 0 6.664.02l4.238-.013 2.012.02c3.699-.05 3.699-.05 6.937-1.7 1.25-1.898 1.79-3.378 2.274-5.597l.527-2.363.531-2.57.578-2.723c2.809-13.621 5.031-27.285 6.262-41.137.394-4.273.75-8.55 1.066-12.832l.325-3.906.113-1.809c.23-2.66.504-4.273 2.16-6.406 2.598-1.895 4.387-1.426 7.543-1.125 2.25 1.5 2.25 1.5 3 3.75.555 7.344-.484 14.824-1.219 22.125l-.195 1.977c-.957 9.492-2.203 18.902-3.836 28.304l-.273 1.57c-1.407 8.07-3.196 16.016-4.977 24.024H219l-2.39-11.11c-4.032-19.28-7.204-38.94-8.11-58.64l-.137-2.387-.082-2.422-.094-2.207c.403-2.55 1.329-3.398 3.313-4.984 1.5-.398 1.5-.398 3-.375l1.5-.023c2.266.601 3.059 1.546 4.5 3.398.426 2.18.676 4.14.816 6.34l.16 1.91c.11 1.355.215 2.71.317 4.066.27 3.59.59 7.176.914 10.762l.191 2.18c1.282 14.031 3.73 27.902 6.649 41.68l.531 2.574.527 2.36.45 2.058c.91 2.375 1.578 3.367 3.695 4.82 2.36.441 4.684.422 7.078.398l2.086.008c1.45.004 2.902-.004 4.356-.015 2.222-.016 4.445 0 6.664.02l4.238-.013 2.012.02c3.742-.047 3.742-.047 6.984-1.785 1.625-2.453 1.527-4 1.082-6.883-2.11-3.543-4.809-5.266-8.25-7.5-10.004-6.527-12.29-16.871-14.746-27.977-1.36-6.546-2.426-13.144-3.488-19.742l-.309-1.879c-2.93-18.05-2.93-18.05-.535-22.168 2.531-1.363 4.246-1.34 7.078-.984 1.59.79 1.59.79 3 2.25a41.149 41.149 0 0 1 1.176 5.703l.27 1.711c.183 1.184.363 2.375.538 3.563.414 2.757.88 5.507 1.34 8.257l.535 3.25c1.72 10.387 3.465 20.704 6.641 30.766l.61 2.07c1.202 2.266 2.62 3.028 4.827 4.305 6.731 4.078 11.954 8.25 14.063 16.125.145 2.734.145 2.734.094 5.531l-.043 2.828L282 370.5c12.32.465 21.953-.258 31.5-9 6.09-6.754 9.863-14.805 9.75-24-.77-9.55-5.016-16.805-12-23.25-4.594-3.496-9.637-5.43-15.086-7.223-4.367-2.074-5.937-6.043-7.742-10.308l-.684-1.606c-5.629-13.422-8.46-27.336-10.988-41.613-5.484.559-10.79 1.738-16.172 2.906-15.562 3.297-31.203 5.43-47.129 5.496l-2.61.016c-26.737.129-52.573-1-78.566-7.805-2.578-.73-2.578-.73-5.523-.613Zm0 0"
                        />
                        <path
                          style="stroke:none;fill-rule:nonzero;fill:currentColor;fill-opacity:1"
                          d="m194.11 146.602 1.847-.008c1.281-.004 2.563.004 3.844.015 1.945.016 3.887 0 5.832-.02l3.758.013 1.738-.02c4.828.082 8.687 1.57 12.387 4.703 3.023 3.719 4.547 6.469 4.39 11.418-1.27 7.317-6.8 11.637-11.906 16.547-.629.672-1.254 1.344-1.902 2.031-1.864 1.735-3.246 2.36-5.598 3.219-.578 4.52-.762 8.898 1.77 12.836 3.292 4.031 7.156 7.512 10.98 11.023 1.148 1.09 2.297 2.184 3.441 3.278 2.496 2.39 5.02 4.754 7.563 7.097 1.644 1.676 1.754 2.61 1.98 5-.277 3.246-.82 4.356-3.234 6.516-2.676.93-3.969.965-6.602-.094-2.816-1.652-4.843-3.566-7.101-5.89l-1.293-1.301a798.505 798.505 0 0 1-4.035-4.106c-.918-.93-1.836-1.859-2.758-2.789-2.242-2.265-4.48-4.539-6.711-6.82-3.043 1.2-5.004 3.375-7.21 5.695-.821.844-1.642 1.684-2.462 2.528a923.054 923.054 0 0 0-3.836 3.984c-1.238 1.29-2.48 2.57-3.734 3.848l-1.133 1.203c-2.656 2.699-4.914 3.804-8.625 4.492-2.29-.52-3.402-1.176-5.11-2.766-1.34-2.609-1.374-4.074-.89-6.984 2.676-3.992 6.496-7.203 10.004-10.457 1.312-1.234 2.621-2.473 3.934-3.707.894-.84 1.8-1.668 2.714-2.484 6.418-5.676 6.418-5.676 9.008-13.563.074-2.18.02-4.363-.16-6.539l-1.762-.645c-2.535-1.09-3.855-2.593-5.738-4.605-.75-.73-1.5-1.453-2.258-2.176l-2.336-2.277-1.191-1.137c-3.621-3.547-5.785-7.164-6.262-12.347.113-3.813 1.602-6.688 3.938-9.625 4.668-3.735 8.777-5.149 14.718-5.086ZM190.5 160.5c-.246 2.316-.246 2.316 1.371 3.84l1.816 1.738 1.793 1.73c.586.56 1.168 1.118 1.77 1.692l1.59 1.703c1.351 1.508 1.351 1.508 3.52 1.484 3.566-1.398 5.324-3.976 7.64-6.937.73-.879 1.465-1.754 2.203-2.625l1.547-1.875c-.828-.996-.828-.996-2.898-.836l-2.848.012-1.508.004c-1.598.004-3.195.015-4.793.023-3.734.008-7.469.024-11.203.047Zm53.25-48.75c1.496 1.41 2.648 2.664 3.89 4.266 5.715 6.761 12.977 10.02 21.755 10.898 1.675.09 3.335.121 5.011.117l1.836.004c5.23-.086 10.145-.984 15.203-2.285 3.594-.898 6.364-1.145 10.055-.25 2.36 2.059 2.926 3.281 3.422 6.375-.543 3.383-1.543 4.223-4.172 6.375-2.031.719-3.824 1.25-5.906 1.688l-1.551.363c-15.336 3.504-31.93 3.117-45.98-4.48-5.625-3.598-11.415-8.532-14.063-14.821-.305-2.82.105-5.09 1.781-7.453 3-1.961 5.36-1.645 8.719-.797Zm-75.516.797c1.559 1.793 2.051 3.406 2.23 5.77-.437 3.413-2.573 5.847-4.714 8.433l-1.156 1.41c-7.207 7.938-18.496 12.3-29.074 12.945-11.325.426-24.97.72-35.02-5.355-1.867-2.805-1.844-4.18-1.5-7.5 1.383-2.45 2.21-3.52 4.93-4.316 3.37-.243 6.199.488 9.46 1.27 12.43 2.71 25.883 3.37 37.016-3.735 2.95-2.352 5.332-5.125 7.746-8 3.051-3.285 6.246-2.684 10.082-.922Zm0 0"
                        />
                      </>
                    </svg>
                    <p>No hay APIKeys</p>
                  </div>
                )
              }
            </section>
          </div>
        </section>
      </div>
    </section>

    <!-- Errors containers -->
    <section
      id="errorContainer"
      class="absolute right-2 bottom-2 h-fit w-fit flex flex-col space-y-2 first:mt-0 last:mb-0"
    >
    </section>
  </main>
</Layout>
<script type="module" define:vars={{ __token }}>
  let inQueue = false;

  //document.querySelectorAll('[data-type="delete"]').forEach((el: any) => {
  document.querySelectorAll('[data-type="delete"]').forEach((el) => {
    el.addEventListener("click", async () => {
      if (inQueue) return;
      inQueue = true;
      const key = el.getAttribute("data-key");
      fetch("http://localhost:8000/api-key", {
        method: "DELETE",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${__token}`,
        },
        body: JSON.stringify({ key_hash: key }),
      })
        .then((res) => res.json())
        .then((data) => {
          inQueue = false;
          if (data.status == "ok") {
            // window.location.reload();
            el.parentElement.parentElement.remove();
            const errorContainer = document.getElementById("errorContainer");
            errorContainer.innerHTML = `
                  <div id="success-msg" class="flex items-center justify-between cursor-pointer select-none bg-green-500 hover:bg-green-400 border border-green-500 shadow-md font-nunito text-sm text-white max-w-sm py-2 px-4 rounded-md">
                      <svg class="w-4 h-4 text-white" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10m0-2a8 8 0 1 0 0-16a8 8 0 0 0 0 16m-1-5h2v2h-2zm0-8h2v6h-2z"/></svg>
                      <p class="mx-2 max-w-[80%]">
                          Se ha eliminado correctamente la APIKey.
                      </p>
                      <svg class="w-4 h-4 text-white" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="m12 10.587l4.95-4.95l1.414 1.414l-4.95 4.95l4.95 4.95l-1.415 1.414l-4.95-4.95l-4.949 4.95l-1.414-1.415l4.95-4.95l-4.95-4.95L7.05 5.638z"/></svg>
                  </div>
              `;
            let _successEl = document.getElementById(`success-msg`);
            if (_successEl) {
                _successEl.addEventListener("click", () => {
                    _successEl.remove();
                });
            }
          }
        })
        .catch((err) => {
          const errorContainer = document.getElementById("errorContainer");
          errorContainer.innerHTML = `
                <div id="error-msg" class="flex items-center justify-between cursor-pointer select-none bg-red-500 hover:bg-red-400 border border-red-500 shadow-md font-nunito text-sm text-white max-w-sm py-2 px-4 rounded-md">
                    <svg class="w-4 h-4 text-white" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10m0-2a8 8 0 1 0 0-16a8 8 0 0 0 0 16m-1-5h2v2h-2zm0-8h2v6h-2z"/></svg>
                    <p class="mx-2 max-w-[80%]">
                        No se ha podido eliminar la APIKey.
                    </p>
                    <svg class="w-4 h-4 text-white" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="m12 10.587l4.95-4.95l1.414 1.414l-4.95 4.95l4.95 4.95l-1.415 1.414l-4.95-4.95l-4.949 4.95l-1.414-1.415l4.95-4.95l-4.95-4.95L7.05 5.638z"/></svg>
                </div>
            `;
          let _errorEl = document.getElementById(`error-msg`);
          if (_errorEl) {
            _errorEl.addEventListener("click", () => {
              _errorEl.remove();
            });
          }
          inQueue = false;
        });
    });
  });

  // document.querySelectorAll('.details-title').forEach((el: any) => {
  document.querySelectorAll(".details-title").forEach((el) => {
    el.addEventListener("click", () => {
      const expanded = el.parentElement?.getAttribute("data-expanded");
      if (expanded === "true") {
        el.parentElement?.setAttribute("data-expanded", "false");
      } else {
        // const groupData: any = document.querySelector('[data-expanded="true"]');
        const groupData = document.querySelector('[data-expanded="true"]');
        if (groupData) {
          groupData.dataset.expanded = false;
        }
        el.parentElement?.setAttribute("data-expanded", "true");
      }
    });
  });

  document
    .getElementById("createAPIKey")
    ?.addEventListener("click", async () => {
      if (inQueue) return;
      inQueue = true;
      document.getElementById("createAPIKey").disabled = true;
      fetch("http://localhost:8000/api-key", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${__token}`,
        },
        body: JSON.stringify({}),
      })
        .then((res) => res.json())
        .then((data) => {
          inQueue = false;
          document.getElementById("createAPIKey").disabled = false;
          if (data.status == "ok") {
            window.location.reload();
          }
        })
        .catch((err) => {
          const errorContainer = document.getElementById("errorContainer");
          errorContainer.innerHTML = `
                <div id="error-msg" class="flex items-center justify-between cursor-pointer select-none bg-red-500 hover:bg-red-400 border border-red-500 shadow-md font-nunito text-sm text-white max-w-sm py-2 px-4 rounded-md">
                    <svg class="w-4 h-4 text-white" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10m0-2a8 8 0 1 0 0-16a8 8 0 0 0 0 16m-1-5h2v2h-2zm0-8h2v6h-2z"/></svg>
                    <p class="mx-2 max-w-[80%]">
                        Has superado el n√∫mero l√≠mite de APIKeys que puedes generar con tu plan actual. Considera mejorarlo.
                    </p>
                    <svg class="w-4 h-4 text-white" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="m12 10.587l4.95-4.95l1.414 1.414l-4.95 4.95l4.95 4.95l-1.415 1.414l-4.95-4.95l-4.949 4.95l-1.414-1.415l4.95-4.95l-4.95-4.95L7.05 5.638z"/></svg>
                </div>
            `;
          let _errorEl = document.getElementById(`error-msg`);
          if (_errorEl) {
            _errorEl.addEventListener("click", () => {
              _errorEl.remove();
            });
          }
          inQueue = false;
          document.getElementById("createAPIKey").disabled = false;
        });
    });
</script>
